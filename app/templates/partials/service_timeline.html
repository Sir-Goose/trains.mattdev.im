<div class="journey-timeline">
    {% set all_previous = service.all_previous_stops %}
    {% set all_subsequent = service.all_subsequent_stops %}
    
    <!-- Previous Stops (where train has been) -->
    {% for stop in all_previous %}
    <div class="timeline-stop passed-stop">
        <div class="timeline-marker">
            <div class="marker-icon marker-passed">✓</div>
            <div class="timeline-line"></div>
        </div>
        
        <div class="stop-details">
            <div class="stop-header">
                <h3 class="stop-name">{{ stop.locationName }}</h3>
                <span class="stop-crs">{{ stop.crs }}</span>
            </div>
            
            <div class="stop-times">
                {% if stop.ata or stop.eta or stop.pta %}
                <div class="time-row">
                    <span class="time-label">Arrival:</span>
                    <span class="time-value">
                        {% if stop.ata and stop.ata != "On time" %}
                            {{ stop.ata }} <span class="actual-badge">Actual</span>
                        {% elif stop.eta and stop.eta != "On time" %}
                            <span class="scheduled-time">{{ stop.pta or stop.st }}</span> → {{ stop.eta }}
                        {% else %}
                            {{ stop.pta or stop.st }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                {% if stop.at or stop.et or stop.st %}
                <div class="time-row">
                    <span class="time-label">Departure:</span>
                    <span class="time-value">
                        {% if stop.at and stop.at != "On time" %}
                            {{ stop.at }} <span class="actual-badge">Actual</span>
                        {% elif stop.et and stop.et != "On time" %}
                            <span class="scheduled-time">{{ stop.st }}</span> → {{ stop.et }}
                        {% else %}
                            {{ stop.st }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    
    <!-- Current Station -->
    <div class="timeline-stop current-stop">
        <div class="timeline-marker">
            <div class="marker-icon marker-current">●</div>
            {% if all_subsequent %}
            <div class="timeline-line"></div>
            {% endif %}
        </div>
        
        <div class="stop-details">
            <div class="stop-header">
                <h3 class="stop-name">{{ service.locationName }}</h3>
                <span class="stop-crs">{{ service.crs }}</span>
            </div>
            
            <div class="stop-times">
                {% if service.sta or service.eta or service.ata %}
                <div class="time-row">
                    <span class="time-label">Arrival:</span>
                    <span class="time-value">
                        {% if service.ata and service.ata != "On time" %}
                            {{ service.ata }} <span class="actual-badge">Actual</span>
                        {% elif service.eta and service.eta != "On time" %}
                            <span class="scheduled-time">{{ service.sta }}</span> → {{ service.eta }}
                        {% else %}
                            {{ service.sta }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                {% if service.std or service.etd or service.atd %}
                <div class="time-row">
                    <span class="time-label">Departure:</span>
                    <span class="time-value">
                        {% if service.atd and service.atd != "On time" %}
                            {{ service.atd }} <span class="actual-badge">Actual</span>
                        {% elif service.etd and service.etd != "On time" %}
                            <span class="scheduled-time">{{ service.std }}</span> → {{ service.etd }}
                        {% else %}
                            {{ service.std }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Upcoming Stops -->
    {% for stop in all_subsequent %}
    <div class="timeline-stop upcoming-stop">
        <div class="timeline-marker">
            <div class="marker-icon marker-upcoming">○</div>
            {% if not loop.last %}
            <div class="timeline-line"></div>
            {% endif %}
        </div>
        
        <div class="stop-details">
            <div class="stop-header">
                <h3 class="stop-name">{{ stop.locationName }}</h3>
                <span class="stop-crs">{{ stop.crs }}</span>
                {% if loop.first %}
                <span class="next-stop-badge">Next Stop</span>
                {% endif %}
            </div>
            
            <div class="stop-times">
                {% if stop.pta or stop.st %}
                <div class="time-row">
                    <span class="time-label">Arrival:</span>
                    <span class="time-value">
                        {% if stop.ata and stop.ata != "On time" %}
                            {{ stop.ata }} <span class="actual-badge">Actual</span>
                        {% elif stop.eta and stop.eta != "On time" %}
                            <span class="scheduled-time">{{ stop.pta or stop.st }}</span> → {{ stop.eta }}
                        {% else %}
                            {{ stop.pta or stop.st }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                {% if stop.st %}
                <div class="time-row">
                    <span class="time-label">Departure:</span>
                    <span class="time-value">
                        {% if stop.at and stop.at != "On time" %}
                            {{ stop.at }} <span class="actual-badge">Actual</span>
                        {% elif stop.et and stop.et != "On time" %}
                            <span class="scheduled-time">{{ stop.st }}</span> → <span class="status-delayed">{{ stop.et }}</span>
                        {% else %}
                            {{ stop.st }} <span class="ontime-text">On time</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
